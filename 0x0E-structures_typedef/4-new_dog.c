Remember that each malloc needs a free and that the order of freeing matters
